/*
 * Created on Aug 18, 2011
 *
 * TODO To change the template for this generated file go to
 * Window - Preferences - Java - Code Style - Code Templates
 */
package com.telstra.olb.tegcbm.job.tbRegnImproved.paperstatus.dao;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.support.JdbcDaoSupport;

import com.accenture.billfilemanagement.exception.MissingDataException;
import com.accenture.billfilemanagement.valueobject.RequestVO;

/**
 * @author vijay.ganesh.s
 *
 * TODO To change the template for this generated type comment go to
 * Window - Preferences - Java - Code Style - Code Templates
 */
public class ClientBufferDAO extends JdbcDaoSupport {
	
	private static Log log = LogFactory.getLog(ClientBufferDAO.class);
	String INSERT_REQ_BUFFER = "INSERT INTO OLB_DBA.BFM_REQ_CLIENT_BUFFER_T(INDEX_NUM,ACC_NUM,ACC_TYPE,REQUEST,SYSTEM_ID,FUTURE_DATE,NUM_RESENDS,STATUS,AUTO_PAPER_OFF,CREATED_DATE,UPDATED_DATE,BILL_FORMAT,BILL_HISTORY_MONTHS) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?)";
	String SELECT_REQ_BUFFER = "SELECT INDEX_NUM,ACC_TYPE,REQUEST,SYSTEM_ID,FUTURE_DATE,NUM_RESENDS,STATUS,AUTO_PAPER_OFF,CREATED_DATE,UPDATED_DATE,BILL_FORMAT,BILL_HISTORY_MONTHS from OLB_DBA.BFM_REQ_CLIENT_BUFFER_T WHERE ACC_NUM=?";
	
    /**
     * This method is responsible for SELECTING the previously inserted BFM_CLIENT_REQ_BUFFER_T.
     * 
     * @param accountMap
     */
    public List paperStatusData() {
    	List accountMap = null;
        if (log.isDebugEnabled()) { log.debug("Updating the Paper Status Date in TBOlbRegnSpringDao");}
        accountMap = (List) getJdbcTemplate().query(SELECT_REQ_BUFFER, new RowMapper() {
        	List dataList = new ArrayList();
            public Object mapRow(ResultSet rs, int rowNum) throws SQLException {
            	try {
	            	RequestVO tbReg = new RequestVO();
	            	tbReg.setIndex(rs.getInt(1));
	                tbReg.setAccType(rs.getString(2));
	                tbReg.setRequest(rs.getString(3));
	                tbReg.setClientSys(rs.getString(4));
	                tbReg.setFutureDate(rs.getDate(5).toString());
	                tbReg.setNumResends(rs.getInt(6));
	                tbReg.setReqStatus(rs.getString(7));
	                tbReg.setPendingFutureDate(rs.getString(8));
	                tbReg.setCreatedDate(rs.getTimestamp(9));
	                tbReg.setUpdatedDate(rs.getTimestamp(10));
	                tbReg.setBillFormatLogicApplied(true);
	                tbReg.setBillHistoryMonths(rs.getInt(12));
	                dataList.add(tbReg);
            	} catch (Exception e) {
            		e.printStackTrace();
            	}                
                return dataList;
            }
        });
        return accountMap;
    }

}
