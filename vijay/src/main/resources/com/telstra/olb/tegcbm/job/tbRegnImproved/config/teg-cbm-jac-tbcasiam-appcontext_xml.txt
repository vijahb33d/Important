<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans default-lazy-init="true">

	<bean id="cbmjac.generateTBReport.manager" class="com.telstra.olb.tegcbm.job.core.DefaultManagerImpl">
		<property name="usage"> <value> <![CDATA[generateTBReport]]> </value> </property>
		<property name="jobs">
			<list>
				<ref local="cbmjac.tbcasiam.billprocess.activity"/>
				<ref local="cbmjac.tbcasiam.paperstatus.activity"/>
				<ref local="cbmjac.tbcasiam.buffer.activity"/>
				<ref local="cbmjac.tbcasiam.csv.generator.activity"/>
				<ref local="cbmjac.tbcasiam.csv.mail.activity"/>
			</list>
		</property>
	</bean>

	<bean id="cbmjac.tbcasiam.billprocess.activity" class="com.telstra.olb.tegcbm.job.tbRegnImproved.TBBillProcessorActivity">
		<property name="name"> <value>cbmjac.tbcasiam.billprocess.activity</value> </property>
		<property name="tbOlbImrprovedDao"> <ref local="cbmjac.tbcasiam.billprocess.dao.TBOlbRegnSpringDao"/> </property>
		<property name="billFilePath"> <value>$CM{cbmjac.tbcasiam.billprocess.filePath}</value></property>
		<property name="nextActivity"> <ref local="cbmjac.tbcasiam.paperstatus.activity"/> </property>
	</bean>
	
	<bean id="cbmjac.tbcasiam.billprocess.TransactionInterceptor" class="org.springframework.transaction.interceptor.TransactionInterceptor">
		<property name="transactionManager"> 
			<bean class="org.springframework.jdbc.datasource.DataSourceTransactionManager"> 
				<property name="dataSource" ref="cbmjac.cbm.jdbc.DataSource"/> 
			</bean> 
		</property>
        <property name="transactionAttributeSource">
            <bean class="org.springframework.transaction.interceptor.NameMatchTransactionAttributeSource">
                <property name="properties">
                    <props> 
						<prop key="insert*">PROPAGATION_REQUIRED,-Exception</prop>
						<prop key="update*">PROPAGATION_REQUIRED,-Exception</prop>
						<prop key="*">PROPAGATION_SUPPORTS,readOnly</prop>
                    </props>
                </property>
            </bean>
        </property>
	</bean>
	
	<bean id="cbmjac.tbcasiam.billprocess.dao.TBOlbRegnSpringDao" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="target"> <ref local="cbmjac.tbcasiam.billprocess.dao.TBOlbRegnSpringDao.target"/> </property>
        <property name="interceptorNames"> <list><value>cbmjac.tbcasiam.billprocess.TransactionInterceptor</value></list> </property>
    </bean>
	
	<bean id="cbmjac.tbcasiam.billprocess.dao.TBOlbRegnSpringDao.target" class="com.telstra.olb.tegcbm.job.tbRegnImproved.dao.TBOlbRegnSpringDao">
		<property name="jdbcTemplate"><ref bean="cbmjac.cbm.jdbcTemplate"/></property>
	</bean>

	<bean id="cbmjac.tbcasiam.paperstatus.activity" class="com.telstra.olb.tegcbm.job.tbRegnImproved.TBPaperStatusUpdateActivity">
		<property name="name"> <value>cbmjac.tbcasiam.paperstatus.update.activity</value> </property>
		<property name="tbOlbSpringDao"> <ref local="cbmjac.tbcasiam.billprocess.dao.TBOlbRegnSpringDao"/> </property>
		<property name="nextActivity"> <ref local="cbmjac.tbcasiam.buffer.activity"/> </property>
	</bean>

	<bean id="bfmSessionFacade" lazy-init="true" class="org.springframework.ejb.access.SimpleRemoteStatelessSessionProxyFactoryBean">
		<property name="jndiTemplate"><ref bean="jndiTemplate"/></property>
		<property name="jndiName"><value>cell/clusters/BFM_Cluster/ejb/BFMSessionFacade</value></property>
	    <property name="businessInterface"><value>com.accenture.billfilemanagement.ejb.facade.BFMSessionFacade</value></property>
		<property name="lookupHomeOnStartup"><value>false</value></property>
		<property name="refreshHomeOnConnectFailure"><value>true</value></property>
	</bean>
	
	<bean id="jndiTemplate" class="org.springframework.jndi.JndiTemplate">
		<property name="environment">
			<props>
				<prop key="java.naming.factory.initial">$CM{java.naming.factory.initial}</prop>
				<prop key="java.naming.provider.url">$CM{cbmjac.olb.jndiTemplate.provider.url}</prop>
			</props>
		</property>
	</bean>

	<bean id="cbmjac.tbcasiam.buffer.activity" class="com.telstra.olb.tegcbm.job.tbRegnImproved.TBBufferClientActivity">
		<property name="name"> <value>cbmjac.tbcasiam.buffer.activity</value> </property>
		<property name="tbOlbSpringDao"> <ref local="cbmjac.tbcasiam.billprocess.dao.TBOlbRegnSpringDao"/> </property>
		<property name="bfmSession"> <ref local="bfmSessionFacade"/> </property>
		<property name="nextActivity"> <null/> </property>
	</bean>

	<!-- Ramesh added for Reports Generation purpose -->
	<bean id="cbmjac.tbcasiam.csv.generator.activity" class="com.telstra.olb.tegcbm.job.tbRegnImproved.generator.TBReportGeneratorActivity">
		<property name="name"> <value>cbmjac.tbcasiam.csv.generator.activity</value> </property>
		<property name="tbOlbImrprovedDao"> <ref local="cbmjac.tbcasiam.billprocess.dao.TBOlbRegnSpringDao"/> </property>
		<property name="csvFilePath"> <value>$CM{cbmjac.tbcasiam.generation.csv.filePath}</value></property>
		<property name="nextActivity"> <ref local="cbmjac.tbcasiam.csv.mail.activity"/> </property>
	</bean>
	<bean id="cbmjac.tbcasiam.csv.mail.activity" class="com.telstra.olb.tegcbm.job.tbRegnImproved.TBRegnSendCSVReportActivity">
		<property name="name"> <value>cbmjac.tbcasiam.csv.mail.activity</value> </property>
		<property name="tbOlbImrprovedDao"> <ref local="cbmjac.tbcasiam.billprocess.dao.TBOlbRegnSpringDao"/> </property>
		<property name="mailHost"> <value>$CM{mail_host}</value></property>
		<property name="csvFilePath"> <value>$CM{cbmjac.tbcasiam.generation.csv.filePath}</value></property>
		<!-- <property name="from"> <value>Telstra-TB-Registrations</value></property>
		<property name="subject"> <value>Telstra-TB-Registrations</value></property>
		 -->
		<property name="nextActivity"> <null/> </property>
	</bean>
	<!--Reports Generation End. -->

</beans>